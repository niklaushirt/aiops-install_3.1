#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# ADAPT VALUES
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


export appgroupid=1000
export appid=1000
export version=1

#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# DO NOT EDIT BELOW
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------








































echo "   __________  __ ___       _____    ________            "
echo "  / ____/ __ \/ // / |     / /   |  /  _/ __ \____  _____"
echo " / /   / /_/ / // /| | /| / / /| |  / // / / / __ \/ ___/"
echo "/ /___/ ____/__  __/ |/ |/ / ___ |_/ // /_/ / /_/ (__  ) "
echo "\____/_/      /_/  |__/|__/_/  |_/___/\____/ .___/____/  "
echo "                                          /_/            "
echo ""
echo "***************************************************************************************************************************************************"
echo "***************************************************************************************************************************************************"
echo ""
echo " üöÄ  AI OPS Similar Incidents Training"
echo ""
echo "***************************************************************************************************************************************************"
echo "  "
echo "   üîé  Training for Similar Incidents"
echo "         Application Group  : $appgroupid"
echo "         Application        : $appid"
echo "         Version            : $version"
echo "  "
echo "***************************************************************************************************************************************************"


  read -p "Does this sound right? [y,N] " DO_COMM
  if [[ $DO_COMM == "y" ||  $DO_COMM == "Y" ]]; then
      echo "‚úÖ Ok, continuing..."
  else
    echo "‚ùå Aborted"
    exit 1
  fi

oc project aiops

executeInTrainingPod(){
  title=$1
  command=$2
  echo "üõ∞Ô∏è   $title:     $command"
  oc exec -it $TRAINING_POD -- $command
}


printForTrainingPod(){
  command=$1
  echo "$command"
}


export TRAINING_POD=$(oc get po |grep model-train-console|awk '{print$1}')
export SIMILAR_INCIDENTS=similar-incident-service



echo "Training pod is $TRAINING_POD"
echo "  "
echo "  "
echo "  "
echo "  "
echo "***************************************************************************************************************************************************"
echo " üöÄ  Create Directories in Training Pod"
echo "***************************************************************************************************************************************************"
executeInTrainingPod "Create Incident Directory" "mkdir -p /home/zeno/data/trainingdata/incident/"




echo "  "
echo "  "
echo "  "
echo "  "
echo "***************************************************************************************************************************************************"
echo " üöÄ  Upload Data to Training Pod"
echo "***************************************************************************************************************************************************"

# Incident
echo "üì• Copy Incident Data to Learner Pod"
oc cp ./tools/5_training/3_incidents/trainingdata/test-incidents.json $(oc get po |grep model-train-console|awk '{print $1}'):/home/zeno/data/trainingdata/incident/test-incidents.json




echo "  "
echo "  "
echo "  "
echo "  "
echo "***************************************************************************************************************************************************"
echo " üöÄ  Execute the following lines in the Training Pod (Copy/Paste)"
echo "***************************************************************************************************************************************************"

echo "vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv"
echo "  "
echo "  "



echo "#----------------------------------------------------------------------------------------------------------------------------------------"
echo "# Create S3 Buckets"
echo "#----------------------------------------------------------------------------------------------------------------------------------------"
# Create S3 Buckets
printForTrainingPod "aws s3 mb s3://$SIMILAR_INCIDENTS"



echo "  "
echo "  "
echo "#----------------------------------------------------------------------------------------------------------------------------------------"
echo "# Remove existing training data from S3 Buckets"
echo "#----------------------------------------------------------------------------------------------------------------------------------------"
# Remove existing training data from S3 Buckets
printForTrainingPod "aws s3 rm s3://$SIMILAR_INCIDENTS/test-incidents.json"



echo "  "
echo "  "
echo "#----------------------------------------------------------------------------------------------------------------------------------------"
echo "# Sync training data to S3 Buckets"
echo "#----------------------------------------------------------------------------------------------------------------------------------------"
# Sync training data to S3 Buckets
printForTrainingPod "aws s3 sync /home/zeno/data/trainingdata/incident/ s3://$SIMILAR_INCIDENTS/"




echo "  "
echo "  "
echo "#----------------------------------------------------------------------------------------------------------------------------------------"
echo "# Train Incident"
echo "#----------------------------------------------------------------------------------------------------------------------------------------"
# Train Incident
printForTrainingPod "cd /home/zeno/incident/"
printForTrainingPod "cp /home/zeno/train/deploy_model.pyc /home/zeno/train/deploy_model.py"
printForTrainingPod "bash index_incidents.sh s3://similar-incident-service/test-incidents.json $appgroupid $appid"
printForTrainingPod "rm /home/zeno/train/deploy_model.py"



echo "  "
echo "  "
echo "^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^"

echo "  "
echo "  "
echo "  "
echo "  "
echo "***************************************************************************************************************************************************"
echo ""
echo " üöÄ  Now entering Learner Pod"
echo ""
echo "***************************************************************************************************************************************************"


oc project aiops
oc exec -it $(oc get po |grep model-train-console|awk '{print$1}') bash



echo "***************************************************************************************************************************************************"
echo "***************************************************************************************************************************************************"
echo ""
echo " ‚úÖ  AI OPS Similar Incidents Training.... DONE...."
echo ""
echo "***************************************************************************************************************************************************"
echo "***************************************************************************************************************************************************"
